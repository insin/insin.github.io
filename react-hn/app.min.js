!function e(t,n,s){function i(o,a){if(!n[o]){if(!t[o]){var m="function"==typeof require&&require;if(!a&&m)return m(o,!0);if(r)return r(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[o]={exports:{}};t[o][0].call(c.exports,function(e){var n=t[o][1][e];return i(n?n:e)},c,c.exports,e,t,n,s)}return n[o].exports}for(var r="function"==typeof require&&require,o=0;o<s.length;o++)i(s[o]);return i}({1:[function(e){"use strict";e("setimmediate");var t=e("react"),n=e("react-router"),s=e("./stores/TopStore"),i=e("./stores/UpdatesStore"),r=e("./Comment"),o=e("./Item"),a=e("./TopStories"),m=e("./Updates"),l=e("./UserProfile"),c=n.DefaultRoute,u=n.Link,p=n.NotFoundRoute,d=n.Route,h=n.Routes,f=t.createClass({displayName:"App",componentWillMount:function(){window.addEventListener("beforeunload",this.handleBeforeUnload)},componentWillUnmount:function(){window.removeEventListener("beforeunload",this.handleBeforeUnload)},handleBeforeUnload:function(){s.saveSession(),i.saveSession()},render:function(){return t.DOM.div({className:"App"},t.DOM.div({className:"App__header"},t.DOM.img({src:"logo.png",width:"16",height:"16",alt:""})," ",u({to:"news",className:"App__homelink"},"React Hacker News")," ",u({to:"newest"},"new")," | ",u({to:"newcomments"},"comments")),t.DOM.div({className:"App__content"},this.props.activeRouteHandler(null)),t.DOM.div({className:"App__footer"},"react-hn v","0.1.0"," | ",t.DOM.a({href:"https://github.com/insin/react-hn"},"insin/react-hn")))}}),v=t.createClass({displayName:"NotFound",render:function(){return t.DOM.h2(null,"Not found")}}),g=h({location:"hash"},d({name:"app",path:"/",handler:f},c({handler:a}),p({handler:v}),d({name:"news",path:"news",handler:a}),d({name:"item",path:"item/:id",handler:o}),d({name:"job",path:"job/:id",handler:o}),d({name:"poll",path:"poll/:id",handler:o}),d({name:"story",path:"story/:id",handler:o}),d({name:"comment",path:"comment/:id",handler:r,permalinked:!0}),d({name:"newest",path:"newest",handler:m,type:"links"}),d({name:"newcomments",path:"newcomments",handler:m,type:"comments"}),d({name:"user",path:"user/:id",handler:l})));window.React=t,t.renderComponent(g,document.getElementById("app"))},{"./Comment":2,"./Item":4,"./TopStories":8,"./Updates":10,"./UserProfile":11,"./stores/TopStore":18,"./stores/UpdatesStore":19,react:"react","react-router":"react-router",setimmediate:28}],2:[function(e,t){"use strict";var n=e("moment"),s=e("react"),i=e("reactfire"),r=e("react-router"),o=e("./services/HNService"),a=e("./stores/ItemStore"),m=e("./Spinner"),l=e("./utils/buildClassName"),c=(e("./utils/pluralise"),e("./utils/setTitle")),u=r.Link,p=r.Navigation,d=s.createClass({displayName:"Comment",mixins:[i,p],getDefaultProps:function(){return{comment:null,level:0,maxCommentId:0,permalinked:!1,permalinkThread:!1,showSpinner:!1,threadStore:null}},getInitialState:function(){return{comment:this.props.comment||{},parent:{type:"comment"},op:{},collapsed:!1}},componentWillMount:function(){null===this.props.comment?this.bindAsObject(o.itemRef(this.props.id||this.props.params.id),"comment"):this.fetchAncestors()},componentWillUpdate:function(e,t){if(this.props.permalinked&&this.state.comment.id!=t.comment.id){if("comment"!=t.comment.type)return void this.replaceWith(t.comment.type,{id:t.comment.id});c("Comment by "+t.comment.by)}},componentDidUpdate:function(e,t){this.shouldUseCommentStore()?t.comment.id||!this.state.comment.id||this.state.comment.deleted?t.comment.id&&!t.comment.deleted&&this.state.comment.deleted&&this.props.threadStore.commentDeleted(this.props.id):this.props.threadStore.commentAdded(this.props.id):this.props.permalinked&&this.state.comment.parent!=t.comment.parent&&this.fetchParent()},componentWillReceiveProps:function(e){this.props.permalinked&&this.props.params.id!=e.params.id&&(this.unbind("comment"),this.bindAsObject(o.itemRef(e.params.id),"comment"))},shouldUseCommentStore:function(){return!this.isInPermalinkThread()&&null===this.props.comment},shouldLinkToParent:function(){return this.props.permalinked||null!==this.props.comment},fetchAncestors:function(){a.fetchCommentAncestors(this.state.comment,function(e){this.isMounted()&&this.setState({parent:e.parent,op:e.op})}.bind(this))},isInPermalinkThread:function(){return this.props.permalinked||this.props.permalinkThread},isNew:function(){return this.props.maxCommentId>0&&this.props.id>this.props.maxCommentId},toggleCollapsed:function(e){e.preventDefault(),this.setState({collapsed:!this.state.collapsed})},render:function(){var e=this.props,t=this.state.comment;if(!t.id)return s.DOM.div({className:l("Comment Comment--loading Comment--level"+e.level,{"Comment--new":this.isNew()})},(e.permalinked||e.showSpinner)&&m({size:"20"}),t.error&&s.DOM.p(null,"Error loading comment - this may be because the author has configured a delay."));if("comment"!=t.type)return null;if(t.deleted&&!t.kids)return null;var i=this.shouldLinkToParent(),r=null!==this.props.comment&&this.state.op.id;return r&&i&&this.state.op.id==t.parent&&(i=!1),s.DOM.div({className:l("Comment Comment--level"+e.level,{"Comment--collapsed":this.state.collapsed,"Comment--dead":t.dead,"Comment--deleted":t.deleted,"Comment--new":this.isNew()})},s.DOM.div({className:"Comment__content"},t.deleted&&s.DOM.div({className:"Comment__meta"},this.renderCollapseControl()," ","[deleted]"),!t.deleted&&s.DOM.div({className:"Comment__meta"},this.renderCollapseControl()," ",u({to:"user",params:{id:t.by},className:"Comment__user"},t.by)," ",n(1e3*t.time).fromNow(),!e.permalinked&&" | ",!e.permalinked&&u({to:"comment",params:{id:t.id}},"link"),i&&" | ",i&&u({to:this.state.parent.type,params:{id:t.parent}},"parent"),r&&" | on: ",r&&u({to:this.state.op.type,params:{id:this.state.op.id}},this.state.op.title),t.dead&&" | [dead]"),!t.deleted&&s.DOM.div({className:"Comment__text"},s.DOM.div({dangerouslySetInnerHTML:{__html:t.text}}))),null===this.props.comment&&t.kids&&s.DOM.div({className:"Comment__kids"},t.kids.map(function(t,n){return d({key:t,id:t,level:e.level+1,showSpinner:e.showSpinner||e.permalinked&&0===n,permalinkThread:e.permalinkThread||e.permalinked,maxCommentId:e.maxCommentId,threadStore:e.threadStore})})))},renderCollapseControl:function(){return s.DOM.span({className:"Comment__collapse",onClick:this.toggleCollapsed,onKeyPress:this.toggleCollapsed,tabIndex:"0"},"[",this.state.collapsed?"+":"–","]")}});t.exports=d},{"./Spinner":7,"./services/HNService":15,"./stores/ItemStore":17,"./utils/buildClassName":20,"./utils/pluralise":25,"./utils/setTitle":26,moment:"moment",react:"react","react-router":"react-router",reactfire:"reactfire"}],3:[function(e,t){"use strict";var n=e("react"),s=e("./stores/CommentThreadStore"),i=e("./mixins/ItemMixin"),r=e("./mixins/ListItemMixin"),o=n.createClass({displayName:"DisplayListItem",mixins:[i,r],propTypes:{item:n.PropTypes.object.isRequired},getInitialState:function(){return s.loadState(this.props.item.id)},render:function(){return this.renderListItem(this.props.item)}});t.exports=o},{"./mixins/ItemMixin":12,"./mixins/ListItemMixin":13,"./stores/CommentThreadStore":16,react:"react"}],4:[function(e,t){"use strict";function n(e){return e.fromNow(!0).replace(/^an? /,"")}var s=e("react"),i=e("reactfire"),r=e("./Comment"),o=e("./stores/CommentThreadStore"),a=e("./services/HNService"),m=e("./PollOption"),l=e("./Spinner"),c=e("./mixins/ItemMixin"),u=e("./utils/buildClassName"),p=e("./utils/setTitle"),d=s.createClass({displayName:"Item",mixins:[c,i],getInitialState:function(){return{item:{},lastVisit:null,commentCount:0,maxCommentId:0,newCommentCount:0}},componentWillMount:function(){this.bindAsObject(a.itemRef(this.props.params.id),"item"),this.initThreadStore(),window.addEventListener("beforeunload",this.handleBeforeUnload)},componentWillUnmount:function(){this.threadStore.dispose(),window.removeEventListener("beforeunload",this.handleBeforeUnload)},componentWillUpdate:function(e,t){this.state.item.id!=t.item.id&&p(t.item.title)},componentWillReceiveProps:function(e){this.props.params.id!=e.params.id&&(this.unbind("item"),this.bindAsObject(a.itemRef(e.params.id),"item"),this.initThreadStore())},initThreadStore:function(){this.threadStore&&this.threadStore.dispose(),this.threadStore=new o(this.props.params.id,this.handleCommentsChanged),this.setState(this.threadStore.getInitialState())},handleBeforeUnload:function(){this.threadStore.dispose()},handleCommentsChanged:function(e){this.setState(e)},markAsRead:function(e){e.preventDefault(),this.setState(this.threadStore.markAsRead())},render:function(){var e=this.state,t=e.item;return t.id?s.DOM.div({className:u("Item",{"Item--dead":t.dead})},s.DOM.div({className:"Item__content"},this.renderItemTitle(t),this.renderItemMeta(t,null!==e.lastVisit&&e.newCommentCount>0&&s.DOM.span(null," ","(",s.DOM.em(null,e.newCommentCount," new")," in the last ",n(e.lastVisit),") | ",s.DOM.span({className:"control",tabIndex:"0",onClick:this.markAsRead,onKeyPress:this.markAsRead},"mark as read"))),t.text&&s.DOM.div({className:"Item__text"},s.DOM.div({dangerouslySetInnerHTML:{__html:t.text}})),"poll"==t.type&&s.DOM.div({className:"Item__poll"},t.parts.map(function(e){return m({key:e,id:e})}))),t.kids&&s.DOM.div({className:"Item__kids"},t.kids.map(function(t,n){return r({key:t,id:t,level:0,showSpinner:0===n,maxCommentId:e.maxCommentId,threadStore:this.threadStore})}.bind(this)))):s.DOM.div({className:"Item Item--loading"},l({size:"20"}))}});t.exports=d},{"./Comment":2,"./PollOption":6,"./Spinner":7,"./mixins/ItemMixin":12,"./services/HNService":15,"./stores/CommentThreadStore":16,"./utils/buildClassName":20,"./utils/setTitle":26,react:"react",reactfire:"reactfire"}],5:[function(e,t){"use strict";var n=e("react"),s=e("react-router"),i=s.Link,r=n.createClass({displayName:"Paginator",render:function(){return 1!=this.props.page||this.props.hasNext?n.DOM.div({className:"Paginator"},this.props.page>1&&n.DOM.span({className:"Paginator__prev"},i({to:this.props.route,query:{page:this.props.page-1}},"Prev")),this.props.page>1&&this.props.hasNext&&" | ",this.props.hasNext&&n.DOM.span({className:"Paginator__next"},i({to:this.props.route,query:{page:this.props.page+1}},"More"))):null}});t.exports=r},{react:"react","react-router":"react-router"}],6:[function(e,t){"use strict";var n=e("react"),s=e("reactfire"),i=e("./services/HNService"),r=e("./Spinner"),o=e("./utils/pluralise"),a=n.createClass({displayName:"PollOption",mixins:[s],getInitialState:function(){return{pollopt:{}}},componentWillMount:function(){this.bindAsObject(i.itemRef(this.props.id),"pollopt")},render:function(){var e=this.state.pollopt;return e.id?n.DOM.div({className:"PollOption"},n.DOM.div({className:"PollOption__text"},e.text),n.DOM.div({className:"PollOption__score"},e.score," point",o(e.score))):n.DOM.div({className:"PollOption PollOption--loading"},r({size:"20"}))}});t.exports=a},{"./Spinner":7,"./services/HNService":15,"./utils/pluralise":25,react:"react",reactfire:"reactfire"}],7:[function(e,t){"use strict";var n=e("react"),s=n.createClass({displayName:"Spinner",getDefaultProps:function(){return{size:6,spacing:2}},render:function(){var e=this.props.size+"px",t={height:e,width:e,marginRight:this.props.spacing+"px"};return n.DOM.div({className:"Spinner",style:{width:3*(this.props.size+this.props.spacing)+"px"}},n.DOM.div({className:"bounce1",style:t}),n.DOM.div({className:"bounce2",style:t}),n.DOM.div({className:"bounce3",style:t}))}});t.exports=s},{react:"react"}],8:[function(e,t){"use strict";var n=e("react"),s=e("reactfire"),i=e("./services/HNService"),r=e("./stores/TopStore"),o=e("./mixins/PageNumberMixin"),a=e("./Paginator"),m=e("./Spinner"),l=e("./TopStoryListItem"),c=e("./utils/constants"),u=e("./utils/pageCalc"),p=e("./utils/setTitle"),d=c.ITEMS_PER_PAGE,h=c.TOP_STORIES,f=n.createClass({displayName:"TopStories",mixins:[o,s],getInitialState:function(){return{items:r.getPageCache(this.getPageNumber()),itemIds:[]}},componentWillMount:function(){this.bindAsObject(i.topStoriesRef(),"itemIds"),p()},componentWillReceiveProps:function(e){this.props.query.page!=e.query.page&&this.setState({items:r.getPageCache(this.getPageNumber(e.query.page))})},render:function(){var e=u(this.getPageNumber(),d,h);if(0===this.state.itemIds.length&&0===this.state.items.length){for(var t=[],s=e.startIndex;s<e.endIndex;s++)t.push(n.DOM.li({className:"ListItem ListItem--loading"},m(null)));return n.DOM.div({className:"Items Items--loading"},n.DOM.ol({className:"Items__list",start:e.startIndex+1},t),a({route:"news",page:e.pageNum,hasNext:e.hasNext}))}return n.DOM.div({className:"Items"},n.DOM.ol({className:"Items__list",start:e.startIndex+1},this.renderItems(e.startIndex,e.endIndex)),a({route:"news",page:e.pageNum,hasNext:e.hasNext}))},renderItems:function(e,t){for(var n=[],s=e,i=0;t>s;s++,i++){var r=this.state.items[i],o=this.state.itemIds[s];n.push(o?l({key:o,id:o,topIndex:s,cachedItem:r}):l({cachedItem:r}))}return n}});t.exports=f},{"./Paginator":5,"./Spinner":7,"./TopStoryListItem":9,"./mixins/PageNumberMixin":14,"./services/HNService":15,"./stores/TopStore":18,"./utils/constants":22,"./utils/pageCalc":24,"./utils/setTitle":26,react:"react",reactfire:"reactfire"}],9:[function(e,t){"use strict";var n=e("react"),s=e("reactfire"),i=e("./stores/CommentThreadStore"),r=e("./services/HNService"),o=e("./stores/TopStore"),a=e("./mixins/ItemMixin"),m=e("./mixins/ListItemMixin"),l=e("./Spinner"),c=n.createClass({displayName:"TopStoryListItem",mixins:[a,m,s],propTypes:{id:n.PropTypes.number,cachedItem:n.PropTypes.object,topIndex:n.PropTypes.number},getDefaultProps:function(){return{id:null,cachedItem:null,topIndex:null}},getInitialState:function(){return{item:this.props.cachedItem||{},lastVisit:null,commentCount:null,maxCommentId:null}},componentWillMount:function(){null!==this.props.id?this.initLiveItem():this.state.item.id&&this.setState(i.loadState(this.state.item.id))},componentWillReceiveProps:function(e){null===this.props.id&&null!==e.id&&this.initLiveItem()},componentWillUpdate:function(e,t){this.state.item!==t.item&&o.setItem(this.props.topIndex,t.item)},initLiveItem:function(){this.bindAsObject(r.itemRef(this.props.id),"item"),this.setState(i.loadState(this.props.id))},render:function(){var e=this.state.item;return e.id?this.renderListItem(e):n.DOM.li({className:"ListItem ListItem--loading"},l(null))}});t.exports=c},{"./Spinner":7,"./mixins/ItemMixin":12,"./mixins/ListItemMixin":13,"./services/HNService":15,"./stores/CommentThreadStore":16,"./stores/TopStore":18,react:"react",reactfire:"reactfire"}],10:[function(e,t){"use strict";var n=e("react"),s=e("./stores/UpdatesStore"),i=e("./DisplayListItem"),r=e("./Comment"),o=e("./Paginator"),a=e("./Spinner"),m=e("./mixins/PageNumberMixin"),l=e("./utils/pageCalc"),c=e("./utils/setTitle"),u=30,p=n.createClass({displayName:"Updates",mixins:[m],getInitialState:function(){return s.getUpdates()},componentWillMount:function(){this.setTitle(this.props.type),s.start(),s.on("updates",this.handleUpdates)},componentWillUnmount:function(){s.off("updates",this.handleUpdates),s.stop()},componentWillReceiveProps:function(e){this.props.type!=e.type&&this.setTitle(e.type)},setTitle:function(e){c("New "+("comments"==e?"Comments":"Links"))},handleUpdates:function(e){return this.isMounted()?void this.setState(e):console.warn("Skipping update of "+this.props.type+" as the Updates component is not mounted")},render:function(){var e="comments"==this.props.type?this.state.comments:this.state.stories;if(0===e.length)return n.DOM.div({className:"Updates Updates--loading"},a({size:"20"}));var t=l(this.getPageNumber(),u,e.length),s=1==t.pageNum&&n.DOM.p({className:"Updates__notice"},"This view will currently only update while you have it open - this will be configurable sometime…");return"comments"==this.props.type?n.DOM.div({className:"Updates Comments"},s,e.slice(t.startIndex,t.endIndex).map(function(e){return r({key:e.id,id:e.id,comment:e})}),o({route:"newcomments",page:t.pageNum,hasNext:t.hasNext})):n.DOM.div({className:"Updates Items"},s,n.DOM.ol({className:"Items__list",start:t.startIndex+1},e.slice(t.startIndex,t.endIndex).map(function(e){return i({key:e.id,item:e})})),o({route:"newest",page:t.pageNum,hasNext:t.hasNext}))}});t.exports=p},{"./Comment":2,"./DisplayListItem":3,"./Paginator":5,"./Spinner":7,"./mixins/PageNumberMixin":14,"./stores/UpdatesStore":19,"./utils/pageCalc":24,"./utils/setTitle":26,react:"react"}],11:[function(e,t){"use strict";var n=e("moment"),s=e("react"),i=e("reactfire"),r=e("./services/HNService"),o=e("./Spinner"),a=e("./utils/setTitle"),m=s.createClass({displayName:"UserProfile",mixins:[i],getInitialState:function(){return{user:{}}},componentWillMount:function(){this.bindAsObject(r.userRef(this.props.params.id),"user")},componentWillUpdate:function(e,t){this.state.user.id!=t.user.id&&a("Profile: "+t.user.id)},componentWillReceiveProps:function(e){this.props.params.id!=e.params.id&&(this.unbind("user"),this.bindAsObject(r.userRef(e.params.id),"user"))},render:function(){var e=this.state.user;if(!e.id)return s.DOM.div({className:"UserProfile UserProfile--loading"},s.DOM.h4(null,this.props.params.id),o({size:"20"}));var t=n(1e3*e.created);return s.DOM.div({className:"UserProfile"},s.DOM.h4(null,e.id),s.DOM.dl(null,s.DOM.dt(null,"Created"),s.DOM.dd(null,t.fromNow()," (",t.format("LL"),")"),s.DOM.dt(null,"Karma"),s.DOM.dd(null,e.karma),s.DOM.dt(null,"Delay"),s.DOM.dd(null,e.delay),e.about&&s.DOM.dt(null,"About"),e.about&&s.DOM.dd(null,s.DOM.div({className:"UserProfile__about",dangerouslySetInnerHTML:{__html:e.about}}))))}});t.exports=m},{"./Spinner":7,"./services/HNService":15,"./utils/setTitle":26,moment:"moment",react:"react",reactfire:"reactfire"}],12:[function(e,t){"use strict";var n=e("react"),s=e("moment"),i=e("react-router"),r=e("../utils/pluralise"),o=i.Link,a=function(){var e=document.createElement("a");return function(t){e.href=t;var n=e.hostname.split(".").slice(-3);return"www"===n[0]&&n.shift(),n.join(".")}}(),m={renderItemMeta:function(e,t){var i=s(1e3*e.time),a=e.kids&&e.kids.length>0?"comments":"discuss";return this.state.commentCount>0&&(a=this.state.commentCount+" comment"+r(this.state.commentCount)),-1!=this.constructor.displayName.indexOf("ListItem")&&(a=o({to:e.type,params:{id:e.id}},a)),"job"==e.type?n.DOM.div({className:"Item__meta"},n.DOM.span({className:"Item__time"},i.fromNow())):n.DOM.div({className:"Item__meta"},n.DOM.span({className:"Item__score"},e.score," point",r(e.score))," ",n.DOM.span({className:"Item__by"},"by ",o({to:"user",params:{id:e.by}},e.by))," ",n.DOM.span({className:"Item__time"},i.fromNow())," | ",a,t)},renderItemTitle:function(e){var t,s=!!e.url;return t=e.dead?"[dead] "+e.title:s?n.DOM.a({href:e.url},e.title):o({to:e.type,params:{id:e.id}},e.title),n.DOM.div({className:"Item__title"},t,s&&" ",s&&n.DOM.span({className:"Item__host"},"(",a(e.url),")"))}};t.exports=m},{"../utils/pluralise":25,moment:"moment",react:"react","react-router":"react-router"}],13:[function(e,t){"use strict";function n(e,t){return e?e.filter(t):[]}var s=e("react"),i=e("react-router"),r=e("../utils/buildClassName"),o=e("../utils/pluralise"),a=i.Link,m={getNewThreadCount:function(e){return null===this.state.lastVisit?0:n(e.kids,function(e){return e>this.state.maxCommentId}.bind(this)).length},renderListItem:function(e){if(e.deleted)return null;var t=this.state,n=this.getNewThreadCount(e),i=n>0;return s.DOM.li({className:r("ListItem",{"ListItem--dead":e.dead})},this.renderItemTitle(e),this.renderItemMeta(e,null!==t.lastVisit&&s.DOM.span(null," ","(",t.lastVisit.fromNow(),")",i&&" | ",i&&a({to:"item",params:{id:e.id}},s.DOM.em(null,n," new thread",o(n))))))}};t.exports=m},{"../utils/buildClassName":20,"../utils/pluralise":25,react:"react","react-router":"react-router"}],14:[function(e,t){"use strict";var n={getPageNumber:function(e){return"undefined"==typeof e&&(e=this.props.query.page),e&&/^\d+$/.test(e)?Math.max(1,Number(e)):1}};t.exports=n},{}],15:[function(e,t){"use strict";function n(e,t){r(e).once("value",function(e){t(e.val())})}function s(e,t){function s(n){i.push(n),i.length>=e.length&&t(i)}var i=[];e.forEach(function(e){n(e,s)})}function i(){return l.child("topstories")}function r(e){return l.child("item/"+e)}function o(e){return l.child("user/"+e)}function a(){return l.child("updates/items")}var m=e("firebase"),l=new m("https://hacker-news.firebaseio.com/v0");t.exports={fetchItem:n,fetchItems:s,topStoriesRef:i,itemRef:r,userRef:o,updatesRef:a}},{firebase:"firebase"}],16:[function(e,t){"use strict";function n(e){var t=o.get(e+m,null);return{lastVisit:null!==t?i(Number(t)):null,commentCount:Number(o.get(e+a,"0")),maxCommentId:Number(o.get(e+l,"0"))}}function s(e,t){function s(){o.set(e+a,f),o.set(e+m,Date.now()),o.set(e+l,I)}function c(){return N}function u(e){f++,S>0&&e>S&&(v++,g[e]=!0),e>I&&(I=e),x(),C&&M()}function p(e){f--,"undefined"!=typeof g[e]&&(v--,delete g[e]),x()}function d(){return v=0,S=I,g={},s(),{lastVisit:i(Date.now()),maxCommentId:I,newCommentCount:v}}function h(){x.cancel(),C&&M.cancel(),s()}var f=0,v=0,g={},I=0,N=n(e),S=N.maxCommentId,C=null===N.lastVisit,x=r(function(){t({commentCount:f,newCommentCount:v})},100),M=null;return C&&(M=r(function(){S=I,C=!1,t({lastVisit:i(Date.now()),maxCommentId:S}),M=null},5e3)),C&&M(),{getInitialState:c,markAsRead:d,commentAdded:u,commentDeleted:p,dispose:h,_getVars:function(){return{commentCount:f,newCommentCount:v,newCommentIds:g,maxCommentId:I,prevMaxCommentId:S,isFirstVisit:C}}}}var i=e("moment"),r=e("../utils/cancellableDebounce"),o=e("../utils/storage"),a=":cc",m=":lv",l=":mc";s.loadState=n,t.exports=s},{"../utils/cancellableDebounce":21,"../utils/storage":27,moment:"moment"}],17:[function(e,t){"use strict";function n(e,t,n){for(var i=e.id,r=e.parent;a[r]||m[r];){if(n.itemCount++,n.cacheHits++,m[r])return 1==n.itemCount&&(n.parent=m[r]),n.op=m[r],void t(n);a[r]&&(1==n.itemCount&&(n.parent={id:r,type:"comment"}),i=r,r=a[r])}l.getItem(r,function(e){n.itemCount++,a[i]=r,"comment"==e.type&&(a[e.id]=e.parent),s(e,t,n)},n)}function s(e,t,s){1==s.itemCount&&(s.parent=e),"comment"!=e.type?(s.op=e,m[e.id]={id:e.id,type:e.type,title:e.title},t(s)):n(e,t,s)}var i=e("../services/HNService"),r=e("./TopStore"),o=e("./UpdatesStore"),a={},m={},l={getItem:function(e,t,n){var s=r.getItem(e)||o.getItem(e);s?(n&&n.cacheHits++,setImmediate(t,s)):i.fetchItem(e,t)},fetchCommentAncestors:function(e,t){var s=Date.now(),i={itemCount:0,cacheHits:0};n(e,function(){i.timeTaken=Date.now()-s,setImmediate(t,i)},i)}};t.exports=l},{"../services/HNService":15,"./TopStore":18,"./UpdatesStore":19}],18:[function(e,t){"use strict";function n(){var e=sessionStorage.topstories;a=e?JSON.parse(e):[],m=a.map(function(e){return e.id})}var s=e("../utils/constants"),i=e("../utils/pageCalc"),r=s.ITEMS_PER_PAGE,o=s.TOP_STORIES,a=null,m=null,l={setItem:function(e,t){null===a&&n(),a[e]=t,m[e]=t.id},getItem:function(e){null===a&&n();var t=m.indexOf(e);return-1!=t?a[t]:null},getPageCache:function(e){null===a&&n();var t=i(e,r,o);return a.slice(t.startIndex,t.endIndex)},saveSession:function(){null!==a&&(sessionStorage.topstories=JSON.stringify(a))}};t.exports=l},{"../utils/constants":22,"../utils/pageCalc":24}],19:[function(e,t){"use strict";function n(e,t){return t.time-e.time}function s(e){var t=Object.keys(e).map(function(t){return e[t]});return t.sort(n),t}function i(){f.comments=r(h.comments),f.stories=r(h.stories)}function r(e){var t=s(e);return t.splice(p,Math.max(0,t.length-p)).forEach(function(t){delete e[t.id]}),t}function o(e){for(var t=0,n=e.length;n>t;t++){var s=e[t];s.deleted||"undefined"==typeof s.error&&"undefined"!=typeof v[s.type]&&("comment"==s.type?h.comments[s.id]=s:h.stories[s.id]=s)}i(),g.emit("updates",f)}function a(){var e=sessionStorage.updates;h=e?JSON.parse(e):{comments:{},stories:{}},i()}var m=e("events").EventEmitter,l=e("../services/HNService"),c=e("../utils/constants"),u=e("../utils/extend"),p=c.UPDATES_CACHE_SIZE,d=null,h=null,f={},v={comment:!0,job:!0,poll:!0,story:!0},g=u(new m,{start:function(){null===h&&a(),null===d&&(d=l.updatesRef(),d.on("value",function(e){l.fetchItems(e.val(),o)}))},getUpdates:function(){return null===h&&a(),f},getItem:function(e){return h.comments[e]||h.stories[e]||null},stop:function(){d.off(),d=null},saveSession:function(){null!==h&&(sessionStorage.updates=JSON.stringify(h))}});g.off=g.removeListener,t.exports=g},{"../services/HNService":15,"../utils/constants":22,"../utils/extend":23,events:"events"}],20:[function(e,t){"use strict";function n(e,t){var n=[];"undefined"==typeof t?t=e:n.push(e);for(var s=Object.keys(t),i=0,r=s.length;r>i;i++)t[s[i]]&&n.push(s[i]);return n.join(" ")}t.exports=n},{}],21:[function(e,t){"use strict";function n(e,t,n){var s,i,r,o,a,m=function(){var l=Date.now()-o;t>l&&l>0?s=setTimeout(m,t-l):(s=null,n||(a=e.apply(r,i),s||(r=i=null)))},l=function(){r=this,i=arguments,o=Date.now();var l=n&&!s;return s||(s=setTimeout(m,t)),l&&(a=e.apply(r,i),r=i=null),a};return l.cancel=function(){s&&clearTimeout(s)},l}t.exports=n},{}],22:[function(e,t){"use strict";t.exports={ITEMS_PER_PAGE:30,SITE_TITLE:"React Hacker News",TOP_STORIES:100,UPDATES_CACHE_SIZE:200}},{}],23:[function(e,t){"use strict";function n(e,t,n){for(var s=Object.keys(t),i=0,r=s.length;r>i;i++)e[s[i]]=t[s[i]];if(n)for(s=Object.keys(n),i=0,r=s.length;r>i;i++)e[s[i]]=n[s[i]];return e}t.exports=n},{}],24:[function(e,t){"use strict";function n(e,t,n){var s=(e-1)*t,i=Math.min(n,s+t),r=n-1>i;return{pageNum:e,startIndex:s,endIndex:i,hasNext:r}}t.exports=n},{}],25:[function(e,t){"use strict";function n(e){return 1==e?"":"s"}t.exports=n},{}],26:[function(e,t){"use strict";function n(e){document.title=e?e+" | "+s:s}var s=e("./constants").SITE_TITLE;t.exports=n},{"./constants":22}],27:[function(e,t){"use strict";t.exports={get:function(e,t){var n=localStorage[e];return"undefined"!=typeof n?n:t},set:function(e,t){localStorage[e]=t}}},{}],28:[function(){!function(e,t){"use strict";function n(e){return h[d]=s.apply(t,e),d++}function s(e){var n=[].slice.call(arguments,1);return function(){"function"==typeof e?e.apply(t,n):new Function(""+e)()}}function i(e){if(f)setTimeout(s(i,e),0);else{var t=h[e];if(t){f=!0;try{t()}finally{r(e),f=!1}}}}function r(e){delete h[e]}function o(){p=function(){var e=n(arguments);return process.nextTick(s(i,e)),e}}function a(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}function m(){var t="setImmediate$"+Math.random()+"$",s=function(n){n.source===e&&"string"==typeof n.data&&0===n.data.indexOf(t)&&i(+n.data.slice(t.length))};e.addEventListener?e.addEventListener("message",s,!1):e.attachEvent("onmessage",s),p=function(){var s=n(arguments);return e.postMessage(t+s,"*"),s}}function l(){var e=new MessageChannel;e.port1.onmessage=function(e){var t=e.data;i(t)},p=function(){var t=n(arguments);return e.port2.postMessage(t),t}}function c(){var e=v.documentElement;p=function(){var t=n(arguments),s=v.createElement("script");return s.onreadystatechange=function(){i(t),s.onreadystatechange=null,e.removeChild(s),s=null},e.appendChild(s),t}}function u(){p=function(){var e=n(arguments);return setTimeout(s(i,e),0),e}}if(!e.setImmediate){var p,d=1,h={},f=!1,v=e.document,g=Object.getPrototypeOf&&Object.getPrototypeOf(e);g=g&&g.setTimeout?g:e,"[object process]"==={}.toString.call(e.process)?o():a()?m():e.MessageChannel?l():v&&"onreadystatechange"in v.createElement("script")?c():u(),g.setImmediate=p,g.clearImmediate=r}}(new Function("return this")())},{}]},{},[1]);