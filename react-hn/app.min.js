!function e(t,n,s){function i(a,o){if(!n[a]){if(!t[a]){var m="function"==typeof require&&require;if(!o&&m)return m(a,!0);if(r)return r(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){var n=t[a][1][e];return i(n?n:e)},u,u.exports,e,t,n,s)}return n[a].exports}for(var r="function"==typeof require&&require,a=0;a<s.length;a++)i(s[a]);return i}({1:[function(e){"use strict";var t=e("react"),n=e("react-router"),s=e("./Comment"),i=e("./Item"),r=e("./Items"),a=e("./Updates"),o=e("./UserProfile"),m=n.DefaultRoute,l=n.Link,u=n.NotFoundRoute,c=n.Route,p=n.Routes,d=t.createClass({displayName:"App",render:function(){return t.DOM.div({className:"App"},t.DOM.div({className:"App__header"},t.DOM.img({src:"logo.png",width:"16",height:"16",alt:""})," ",l({to:"app",className:"App__homelink"},"React Hacker News")," ",l({to:"top"},"top")," | ",l({to:"new"},"new")," | ",l({to:"comments"},"comments")),t.DOM.div({className:"App__content"},this.props.activeRouteHandler(null)),t.DOM.div({className:"App__footer"},t.DOM.a({href:"https://github.com/insin/react-hn"},"Source on GitHub")))}}),h=t.createClass({displayName:"NotFound",render:function(){return t.DOM.h2(null,"Not found")}}),f=p({location:"hash"},c({name:"app",path:"/",handler:d},m({handler:r}),u({handler:h}),c({name:"top",path:"top",handler:r}),c({name:"item",path:"item/:id",handler:i}),c({name:"job",path:"job/:id",handler:i}),c({name:"poll",path:"poll/:id",handler:i}),c({name:"story",path:"story/:id",handler:i}),c({name:"comment",path:"comment/:id",handler:s,permalinked:!0}),c({name:"comments",path:"comments",handler:a,type:"comments"}),c({name:"new",path:"new",handler:a,type:"links"}),c({name:"user",path:"user/:id",handler:o})));window.React=t,t.renderComponent(f,document.getElementById("app"))},{"./Comment":2,"./Item":3,"./Items":4,"./Updates":9,"./UserProfile":10,react:"react","react-router":"react-router"}],2:[function(e,t){"use strict";var n=e("moment"),s=e("react"),i=e("reactfire"),r=e("react-router"),a=e("./stores/CommentThreadStore"),o=e("./stores/ItemStore"),m=e("./Spinner"),l=e("./utils/buildClassName"),u=e("./utils/setTitle"),c=r.Link,p=r.Navigation,d=s.createClass({displayName:"Comment",mixins:[i,p],getDefaultProps:function(){return{comment:null,level:0,maxCommentId:0,permalink:!1,permalinkThread:!1,showSpinner:!1}},getInitialState:function(){return{comment:this.props.comment||{},parent:{type:"comment"},collapsed:!1}},componentWillMount:function(){null===this.props.comment?this.bindAsObject(o.itemRef(this.props.id||this.props.params.id),"comment"):this.fetchParent()},componentWillUpdate:function(e,t){if(this.props.permalinked&&this.state.comment.id!=t.comment.id){if("comment"!=t.comment.type)return void this.replaceWith(t.comment.type,{id:t.comment.id});u("Comment by "+t.comment.by)}},componentDidUpdate:function(e,t){this.shouldUseCommentStore()?t.comment.id||!this.state.comment.id||this.state.comment.deleted?t.comment.id&&!t.comment.deleted&&this.state.comment.deleted&&a.deleteComment(this.props.id):a.addComment(this.props.id):this.props.permalinked&&this.state.comment.parent!=t.comment.parent&&this.fetchParent()},componentWillReceiveProps:function(e){this.props.permalinked&&this.props.params.id!=e.params.id&&(this.unbind("comment"),this.bindAsObject(o.itemRef(e.params.id),"comment"))},shouldUseCommentStore:function(){return!this.isInPermalinkThread()&&null===this.props.comment},shouldLinkToParent:function(){return this.props.permalinked||null!==this.props.comment},fetchParent:function(){o.fetchItem(this.state.comment.parent,function(e){this.setState({parent:e})}.bind(this))},isInPermalinkThread:function(){return this.props.permalinked||this.props.permalinkThread},isNew:function(){return this.props.maxCommentId>0&&this.props.id>this.props.maxCommentId},toggleCollapsed:function(e){e.preventDefault(),this.setState({collapsed:!this.state.collapsed})},render:function(){var e=this.props,t=this.state.comment;if(!t.id)return s.DOM.div({className:l("Comment Comment--loading Comment--level"+e.level,{"Comment--new":this.isNew()})},(e.permalinked||e.showSpinner)&&m({size:"20"}),t.error&&s.DOM.p(null,"Error loading comment - this may be because the author has configured a delay."));if("comment"!=t.type)return null;if(t.deleted&&!t.kids)return null;var i=this.shouldLinkToParent(),r=null!==this.props.comment&&"comment"!=this.state.parent.type;return s.DOM.div({className:l("Comment Comment--level"+e.level,{"Comment--collapsed":this.state.collapsed,"Comment--dead":t.dead,"Comment--deleted":t.deleted,"Comment--new":this.isNew()})},s.DOM.div({className:"Comment__content"},t.deleted&&s.DOM.div({className:"Comment__meta"},this.renderCollapseControl()," ","[deleted]"),!t.deleted&&s.DOM.div({className:"Comment__meta"},this.renderCollapseControl()," ",c({to:"user",params:{id:t.by},className:"Comment__user"},t.by)," ",n(1e3*t.time).fromNow(),!e.permalinked&&" | ",!e.permalinked&&c({to:"comment",params:{id:t.id}},"link"),i&&" | ",i&&c({to:this.state.parent.type,params:{id:t.parent}},"parent"),r&&" | on: ",r&&c({to:this.state.parent.type,params:{id:t.parent}},this.state.parent.title),t.dead&&" | [dead]"),!t.deleted&&s.DOM.div({className:"Comment__text"},s.DOM.div({dangerouslySetInnerHTML:{__html:t.text}}))),null===this.props.comment&&t.kids&&s.DOM.div({className:"Comment__kids"},t.kids.map(function(t,n){return d({key:t,id:t,level:e.level+1,showSpinner:e.showSpinner||e.permalinked&&0===n,permalinkThread:e.permalinkThread||e.permalinked,maxCommentId:e.maxCommentId})})))},renderCollapseControl:function(){return s.DOM.span({className:"Comment__collapse",onClick:this.toggleCollapsed,onKeyPress:this.toggleCollapsed,tabIndex:"0"},"[",this.state.collapsed?"+":"–","]")}});t.exports=d},{"./Spinner":8,"./stores/CommentThreadStore":13,"./stores/ItemStore":14,"./utils/buildClassName":15,"./utils/setTitle":18,moment:"moment",react:"react","react-router":"react-router",reactfire:"reactfire"}],3:[function(e,t){"use strict";function n(e){return e.fromNow(!0).replace(/^an? /,"")}var s=e("react"),i=e("reactfire"),r=e("./Comment"),a=e("./stores/CommentThreadStore"),o=e("./stores/ItemStore"),m=e("./PollOption"),l=e("./Spinner"),u=e("./utils/buildClassName"),c=e("./renderItemTitle"),p=e("./renderItemMeta"),d=e("./utils/setTitle"),h=s.createClass({displayName:"Item",mixins:[i],getInitialState:function(){return{item:{},lastVisit:null,commentCount:0,maxCommentId:0,newCommentCount:0}},componentWillMount:function(){this.bindAsObject(o.itemRef(this.props.params.id),"item"),this.setState(a.init(this.props.params.id,this.handleCommentsChanged)),window.addEventListener("beforeunload",this.handleBeforeUnload)},componentWillUnmount:function(){a.dispose(),window.removeEventListener("beforeunload",this.handleBeforeUnload)},componentWillUpdate:function(e,t){this.state.item.id!=t.item.id&&d(t.item.title)},componentWillReceiveProps:function(e){this.props.params.id!=e.params.id&&(this.unbind("item"),this.bindAsObject(o.itemRef(e.params.id),"item"),a.dispose(),this.setState(a.init(e.params.id,this.handleCommentsChanged)))},handleBeforeUnload:function(){a.dispose()},handleCommentsChanged:function(e){this.setState(e)},markAsRead:function(e){e.preventDefault(),this.setState(a.markAsRead())},render:function(){var e=this.state,t=e.item;return t.id?s.DOM.div({className:u("Item",{"Item--dead":t.dead})},s.DOM.div({className:"Item__content"},c(t),p(t,e,"detail",null!==e.lastVisit&&e.newCommentCount>0&&s.DOM.span(null," ","(",s.DOM.em(null,e.newCommentCount," new")," in the last ",n(e.lastVisit),") | ",s.DOM.span({className:"control",tabIndex:"0",onClick:this.markAsRead,onKeyPress:this.markAsRead},"mark as read"))),t.text&&s.DOM.div({className:"Item__text"},s.DOM.div({dangerouslySetInnerHTML:{__html:t.text}})),"poll"==t.type&&s.DOM.div({className:"Item__poll"},t.parts.map(function(e){return m({key:e,id:e})}))),t.kids&&s.DOM.div({className:"Item__kids"},t.kids.map(function(t,n){return r({key:t,id:t,level:0,showSpinner:0===n,maxCommentId:e.maxCommentId})}))):s.DOM.div({className:"Item Item--loading"},l({size:"20"}))}});t.exports=h},{"./Comment":2,"./PollOption":7,"./Spinner":8,"./renderItemMeta":11,"./renderItemTitle":12,"./stores/CommentThreadStore":13,"./stores/ItemStore":14,"./utils/buildClassName":15,"./utils/setTitle":18,react:"react",reactfire:"reactfire"}],4:[function(e,t){"use strict";var n=e("react"),s=e("reactfire"),i=e("./stores/ItemStore"),r=e("./ListItem"),a=e("./Paginator"),o=e("./Spinner"),m=e("./utils/setTitle"),l=30,u=n.createClass({displayName:"Items",mixins:[s],getInitialState:function(){return{items:[]}},componentWillMount:function(){this.bindAsObject(i.topStoriesRef(),"items"),m("Top 100")},getPage:function(){return this.props.query.page&&/^\d+$/.test(this.props.query.page)?Math.max(1,Number(this.props.query.page)):1},render:function(){var e=this.getPage(),t=(e-1)*l,s=t+l,i=s<this.state.items.length-1;if(0===this.state.items.length){for(var m=[],u=0;l>u;u++)m.push(n.DOM.li({className:"ListItem ListItem--loading"},o(null)));return n.DOM.div({className:"Items Items--loading"},n.DOM.ol({className:"Items__list",start:t+1},m),a({route:"top",page:e,hasNext:i}))}var c=this.state.items.slice(t,s);return n.DOM.div({className:"Items"},n.DOM.ol({className:"Items__list",start:t+1},c.map(function(e){return r({key:e,id:e})})),a({route:"top",page:e,hasNext:i}))}});t.exports=u},{"./ListItem":5,"./Paginator":6,"./Spinner":8,"./stores/ItemStore":14,"./utils/setTitle":18,react:"react",reactfire:"reactfire"}],5:[function(e,t){"use strict";function n(e,t){return e?e.filter(t):[]}var s=e("react"),i=e("reactfire"),r=e("react-router"),a=e("./stores/CommentThreadStore"),o=e("./stores/ItemStore"),m=e("./Spinner"),l=e("./utils/buildClassName"),u=e("./utils/pluralise"),c=e("./renderItemTitle"),p=e("./renderItemMeta"),d=r.Link,h=s.createClass({displayName:"ListItem",mixins:[i],getDefaultProps:function(){return{item:null}},getInitialState:function(){return{item:this.props.item||{},lastVisit:null,commentCount:null,maxCommentId:null}},componentWillMount:function(){null===this.props.item&&this.bindAsObject(o.itemRef(this.props.id),"item"),this.setState(a.getCommentData(this.props.id))},render:function(){var e=this.state,t=e.item;if(!t.id)return s.DOM.li({className:"ListItem ListItem--loading"},m(null));if(t.deleted)return null;var i=null===e.lastVisit?0:n(t.kids,function(t){return t>e.maxCommentId}).length,r=i>0;return s.DOM.li({className:l("ListItem",{"ListItem--dead":t.dead})},c(t),p(t,e,"list",null!==e.lastVisit&&s.DOM.span(null," ","(",e.lastVisit.fromNow(),")",r&&" | ",r&&d({to:"item",params:{id:t.id}},s.DOM.em(null,i," new thread",u(i))))))}});t.exports=h},{"./Spinner":8,"./renderItemMeta":11,"./renderItemTitle":12,"./stores/CommentThreadStore":13,"./stores/ItemStore":14,"./utils/buildClassName":15,"./utils/pluralise":17,react:"react","react-router":"react-router",reactfire:"reactfire"}],6:[function(e,t){"use strict";var n=e("react"),s=e("react-router"),i=s.Link,r=n.createClass({displayName:"Paginator",render:function(){return 1!=this.props.page||this.props.hasNext?n.DOM.div({className:"Paginator"},this.props.page>1&&n.DOM.span({className:"Paginator__prev"},i({to:this.props.route,query:{page:this.props.page-1}},"Prev")),this.props.page>1&&this.props.hasNext&&" | ",this.props.hasNext&&n.DOM.span({className:"Paginator__next"},i({to:this.props.route,query:{page:this.props.page+1}},"More"))):null}});t.exports=r},{react:"react","react-router":"react-router"}],7:[function(e,t){"use strict";var n=e("react"),s=e("reactfire"),i=e("./stores/ItemStore"),r=e("./Spinner"),a=e("./utils/pluralise"),o=n.createClass({displayName:"PollOption",mixins:[s],getInitialState:function(){return{pollopt:{}}},componentWillMount:function(){this.bindAsObject(i.itemRef(this.props.id),"pollopt")},render:function(){var e=this.state.pollopt;return e.id?n.DOM.div({className:"PollOption"},n.DOM.div({className:"PollOption__text"},e.text),n.DOM.div({className:"PollOption__score"},e.score," point",a(e.score))):n.DOM.div({className:"PollOption PollOption--loading"},r({size:"20"}))}});t.exports=o},{"./Spinner":8,"./stores/ItemStore":14,"./utils/pluralise":17,react:"react",reactfire:"reactfire"}],8:[function(e,t){"use strict";var n=e("react"),s=n.createClass({displayName:"Spinner",getDefaultProps:function(){return{size:6,spacing:2}},render:function(){var e=this.props.size+"px",t={height:e,width:e,marginRight:this.props.spacing+"px"};return n.DOM.div({className:"Spinner",style:{width:3*(this.props.size+this.props.spacing)+"px"}},n.DOM.div({className:"bounce1",style:t}),n.DOM.div({className:"bounce2",style:t}),n.DOM.div({className:"bounce3",style:t}))}});t.exports=s},{react:"react"}],9:[function(e,t){"use strict";var n=e("react"),s=e("./Comment"),i=e("./stores/ItemStore"),r=e("./ListItem"),a=e("./Paginator"),o=e("./Spinner"),m=e("./utils/setTitle"),l=30,u=n.createClass({displayName:"Updates",getInitialState:function(){return i.getUpdates()},componentWillMount:function(){this.setTitle(this.props.type),i.startUpdates(),i.on("updates",this.handleUpdates)},componentWillUnmount:function(){i.off("updates",this.handleUpdates),i.stopUpdates()},componentWillReceiveProps:function(e){this.props.type!=e.type&&this.setTitle(e.type)},setTitle:function(e){m("New "+("comments"==e?"Comments":"Links"))},handleUpdates:function(e){return this.isMounted()?void this.setState(e):console.warn("Skipping update of "+this.props.type+" as the Updates component is not mounted")},getPage:function(){return this.props.query.page&&/^\d+$/.test(this.props.query.page)?Math.max(1,Number(this.props.query.page)):1},render:function(){var e=this.getPage(),t=(e-1)*l,i=t+l,m=i<this.state.comments.length-1;if(0===this.state.comments.length)return n.DOM.div({className:"Updates Updates--loading"},o({size:"20"}));var u=1==e&&n.DOM.p({className:"Updates__notice"},"This view will currently only update while you have it open - this will be configurable sometime…");if("comments"==this.props.type){var c=this.state.comments.slice(t,i);return n.DOM.div({className:"Updates Comments"},u,c.map(function(e){return s({key:e.id,id:e.id,comment:e})}),a({route:"comments",page:e,hasNext:m}))}var p=this.state.stories.slice(t,i);return n.DOM.div({className:"Updates Items"},u,n.DOM.ol({className:"Items__list",start:t+1},p.map(function(e){return r({key:e.id,id:e.id,item:e})})),a({route:"new",page:e,hasNext:m}))}});t.exports=u},{"./Comment":2,"./ListItem":5,"./Paginator":6,"./Spinner":8,"./stores/ItemStore":14,"./utils/setTitle":18,react:"react"}],10:[function(e,t){"use strict";var n=e("moment"),s=e("react"),i=e("reactfire"),r=e("./stores/ItemStore"),a=e("./Spinner"),o=e("./utils/setTitle"),m=s.createClass({displayName:"UserProfile",mixins:[i],getInitialState:function(){return{user:{}}},componentWillMount:function(){this.bindAsObject(r.userRef(this.props.params.id),"user")},componentWillUpdate:function(e,t){this.state.user.id!=t.user.id&&o("Profile: "+t.user.id)},componentWillReceiveProps:function(e){this.props.params.id!=e.params.id&&(this.unbind("user"),this.bindAsObject(r.userRef(e.params.id),"user"))},render:function(){var e=this.state.user;if(!e.id)return s.DOM.div({className:"UserProfile UserProfile--loading"},s.DOM.h4(null,this.props.params.id),a({size:"20"}));var t=n(1e3*e.created);return s.DOM.div({className:"UserProfile"},s.DOM.h4(null,e.id),s.DOM.dl(null,s.DOM.dt(null,"Created"),s.DOM.dd(null,t.fromNow()," (",t.format("LL"),")"),s.DOM.dt(null,"Karma"),s.DOM.dd(null,e.karma),s.DOM.dt(null,"Delay"),s.DOM.dd(null,e.delay),e.about&&s.DOM.dt(null,"About"),e.about&&s.DOM.dd(null,s.DOM.div({className:"UserProfile__about",dangerouslySetInnerHTML:{__html:e.about}}))))}});t.exports=m},{"./Spinner":8,"./stores/ItemStore":14,"./utils/setTitle":18,moment:"moment",react:"react",reactfire:"reactfire"}],11:[function(e,t){"use strict";function n(e,t,n,r){var m=i(1e3*e.time),l="job"!=e.type,u=e.kids&&e.kids.length>0?"comments":"discuss";return t.commentCount>0&&(u=t.commentCount+" comment"+a(t.commentCount)),"list"==n&&(u=o({to:e.type,params:{id:e.id}},u)),s.DOM.div({className:"Item__meta"},l&&s.DOM.span({className:"Item__score"},e.score," point",a(e.score))," ",l&&s.DOM.span({className:"Item__by"},"by ",o({to:"user",params:{id:e.by}},e.by))," ",s.DOM.span({className:"Item__time"},m.fromNow()),l&&" | ",l&&u,r)}var s=e("react"),i=e("moment"),r=e("react-router"),a=e("./utils/pluralise"),o=r.Link;t.exports=n},{"./utils/pluralise":17,moment:"moment",react:"react","react-router":"react-router"}],12:[function(e,t){"use strict";function n(e){var t,n=!!e.url;return t=e.dead?"[dead] "+e.title:n?s.DOM.a({href:e.url},e.title):r({to:e.type,params:{id:e.id}},e.title),s.DOM.div({className:"Item__title"},t,n&&" ",n&&s.DOM.span({className:"Item__host"},"(",a(e.url),")"))}var s=e("react"),i=e("react-router"),r=i.Link,a=function(){var e=document.createElement("a");return function(t){e.href=t;var n=e.hostname.split(".").slice(-3);return"www"===n[0]&&n.shift(),n.join(".")}}();t.exports=n},{react:"react","react-router":"react-router"}],13:[function(e,t){"use strict";function n(){r.set(l+a,c),r.set(l+o,Date.now()),r.set(l+m,h)}var s=e("moment"),i=e("../utils/cancellableDebounce"),r=e("../utils/storage"),a=":cc",o=":lv",m=":mc",l=null,u=null,c=null,p=null,d=null,h=null,f=null,v=null,C=i(function(){u({commentCount:c,newCommentCount:p})},100),g=i(function(){f=h,v=!1,u({lastVisit:s(),maxCommentId:f})},5e3);t.exports={init:function(e,t){l=e,u=t,c=0,p=0,d={},h=0;var n=this.getCommentData(l);return f=n.maxCommentId,v=null===n.lastVisit,n},dispose:function(){null!==l&&(C.cancel(),n(),l=null,u=null,d=null)},markAsRead:function(){return p=0,f=h,d={},n(),{lastVisit:s(),maxCommentId:h,newCommentCount:p}},addComment:function(e){c++,f>0&&e>f&&(p++,d[e]=!0),e>h&&(h=e),C(),v&&g()},deleteComment:function(e){c--,"undefined"!=typeof d[e]&&p--,C()},getCommentData:function(e){var t=r.get(e+o,null);return{lastVisit:null!==t?s(Number(t)):null,commentCount:Number(r.get(e+a,"0")),maxCommentId:Number(r.get(e+m,"0"))}}}},{"../utils/cancellableDebounce":16,"../utils/storage":19,moment:"moment"}],14:[function(e,t){"use strict";function n(e,t){return t.time-e.time}function s(e,t){var n=Object.keys(e).map(function(t){return e[t]});return n.sort(t),n}function i(e){var t=s(e,n);return t.splice(u,Math.max(0,t.length-u)).forEach(function(t){delete e[t.id]}),t}function r(e){e.forEach(function(e){e.deleted||e.error||("comment"==e.type?p[e.id]=e:d[e.id]=e)}),h=i(p),f=i(d),l.emitUpdates()}var a=e("events").EventEmitter,o=e("firebase"),m=new o("https://hacker-news.firebaseio.com/v0"),l=new a;l.off=l.removeListener,l.topStoriesRef=function(){return m.child("topstories")},l.itemRef=function(e){return m.child("item/"+e)},l.userRef=function(e){return m.child("user/"+e)},l.fetchItem=function(e,t){this.itemRef(e).once("value",function(e){t(e.val())})},l.fetchItems=function(e,t){function n(n){s.push(n),s.length>=e.length&&t(s)}var s=[];e.forEach(function(e){l.fetchItem(e,n)})},l.startUpdates=function(){null===c&&(c=m.child("updates/items"),c.on("value",function(e){l.fetchItems(e.val(),r)}))},l.getUpdates=function(){return{comments:h,stories:f}},l.emitUpdates=function(){this.emit("updates",this.getUpdates())},l.stopUpdates=function(){c.off(),c=null};var u=200,c=null,p={},d={},h=[],f=[];t.exports=l},{events:"events",firebase:"firebase"}],15:[function(e,t){"use strict";function n(e,t){var n=[];"undefined"==typeof t?t=e:n.push(e);for(var s=Object.keys(t),i=0,r=s.length;r>i;i++)t[s[i]]&&n.push(s[i]);return n.join(" ")}t.exports=n},{}],16:[function(e,t){"use strict";function n(e,t,n){var s,i,r,a,o,m=function(){var l=Date.now()-a;t>l&&l>0?s=setTimeout(m,t-l):(s=null,n||(o=e.apply(r,i),s||(r=i=null)))},l=function(){r=this,i=arguments,a=Date.now();var l=n&&!s;return s||(s=setTimeout(m,t)),l&&(o=e.apply(r,i),r=i=null),o};return l.cancel=function(){s&&clearTimeout(s)},l}t.exports=n},{}],17:[function(e,t){"use strict";function n(e){return 1==e?"":"s"}t.exports=n},{}],18:[function(e,t){"use strict";function n(e){document.title=e?e+" | "+s:s}var s="React Hacker News";t.exports=n},{}],19:[function(e,t){"use strict";t.exports={get:function(e,t){var n=localStorage[e];return"undefined"!=typeof n?n:t},set:function(e,t){localStorage[e]=t}}},{}]},{},[1]);